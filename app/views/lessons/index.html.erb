<div class="container">
<!--
<h3> Current User ID: <%= current_user.id %> </h3>
<h3> Current User.email: <%= current_user.email %> </h3>
 -->

<% if current_user && current_user.email == "brian@snowschoolers.com" %>
<div class="admin-viewable hidden">
  <a href='lessons/admin_index' class='btn btn-warning'>View Full Lesson Details</a>
</div>
<% end %>

<!-- SECTION 0 - AVAILABLE LESSON REQUESTS FOR INSTRUCTORS -->
<% if current_user && current_user.active_instructor? %>
<h3><a href="#hideLessons" class="btn btn-success hidden" id="toggle-available-lessons">Show (hide) Lesson Requests</a></h3>
<div id="available-lessons" class="hidden">
<h1>Lessons Requests</h1>

<table class="instructors-table">
  <thead>
    <tr>
      <th class="lessons-table-cells lesson-instructor">Instructor</th>
      <th class="lessons-table-cells lesson-type">Type</th>
      <!-- <th class="lessons-table-cells">Deposit?</th> -->
      <th class="lessons-table-cells lesson-student">Student</th>
      <!-- <th class="lessons-table-cells">Mountain</th> -->
      <th class="lessons-table-cells lesson-date">Date</th>
      <!-- <th class="lessons-table-cells">Status</th> -->
    </tr>
  </thead>

  <tbody>
    <% @lessons.each do |lesson| %>
        <% if lesson.confirmable? %>
          <tr>
            <td class="lessons-table-cells lesson-instructor"><%= link_to "Review", lesson, class: "btn btn-default" %></td>
            <td class="lessons-table-cells lesson-type"><%= lesson.lesson_time.slot %></td>
            <!-- <td class="lessons-table-cells"><%= lesson.deposit_status %></td> -->
            <td class="lessons-table-cells lesson-student"><%= lesson.requester ? lesson.requester.name : lesson.guest_email %></td>
            <!-- <td class="lessons-table-cells"><%= lesson.location.name %></td> -->
            <td class="lessons-table-cells lesson-date"><%= lesson.lesson_time.date.strftime("%m/%d") %></td>
            <!-- <td class="lessons-table-cells"><%= lesson.state %></td> -->
          </tr>
        <% end %>
    <% end %>
  </tbody>
</table>
</div>
<hr>
<% end %>

<!-- SECTION 1 - PREVIOUS LESSONS -->
<h3><a href="#hideLessons" class="btn btn-success " id="toggle-completed-lessons">Show (hide) Past Lessons</a></h3>
<div id="completed-lessons" class="hidden">
<h1>Previous Lessons</h1>

<table class="instructors-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Instructor</th>
      <th>Type</th>
      <!-- <th>Deposit?</th> -->
      <th>Student</th>
      <!-- <th>Mountain</th> -->
      <th>Date</th>
      <th>Status</th>
    <% if current_user.user_type == "Snow Schoolers Employee" %>
      <th>Price</th>
      <th></th>
      <% else %>
      <th></th>
      <th></th>
    <% end %>
    </tr>
  </thead>

  <tbody>
    <% @lessons.each do |lesson| %>
        <% if lesson.completed? %>
          <tr>
            <% if lesson.instructor %>
            <td><%= image_tag(lesson.instructor.avatar.url(:thumb), alt:"avatar-img", class:"img-responsive img-thumbnail avatar-thumbnail") %></td>
            <td><%= lesson.instructor.name %></td>
            <% else %>
            <td></td>
            <td>TBD</td>
            <% end %>
            <td><%= link_to "#{lesson.lesson_time.slot}", lesson, class: "btn btn-default" %></td>
            <!-- <td><%= lesson.deposit_status %></td> -->
            <% if lesson.requester %>
              <td class="lessons-table-cells lesson-student">Requester: <%= lesson.requester.email %></td>
              <% else %>
              <td class="lessons-table-cells lesson-student">Requester: <%= lesson.guest_email %></td>
            <% end %>            <!-- <td><%= lesson.location.name %></td> -->
            <td><%= lesson.lesson_time.date.strftime("%m/%d") %></td>
            <td><%= lesson.state %></td>
            <% if current_user.user_type == "Snow Schoolers Employee" %>
            <td><%= number_to_currency(lesson.visible_lesson_cost) %></td>
            <td><%= link_to "Send Instructor SMS", send_reminder_sms_to_instructor_path(lesson), class: "btn btn-default" %></td>
            <% else %>
              <td></td>
              <td></td>
            <% end %>
          </tr>
        <%end%>
    <% end %>
  </tbody>
</table>
</div>
<hr>

<!-- SECTION 2 - ACTIVE LESSONS -->

<h3><a href="#hideLessons" class="btn btn-success hidden" id="toggle-upcoming-lessons">Show (hide) upcoming Lessons</a></h3>
<div id="upcoming-lessons" class="">

<% @days.each do |day| %>

<h1 class="center"><b>---Lessons for <%= day.date.strftime("%A %b %e, %Y") %>---</b></h1>

  <% Section.where(date:day.date).sort{ |a,b| a.slot <=> b.slot }.each do |section| %>

    <h3><%= section.slot %> - <%= section.sport_name %> <em> (spots remaining: <%= section.remaining_capacity %>)</em>
     | Instructor: 
      <% if section.instructor %>
        <%= image_tag(section.instructor.avatar.url(:thumb), alt:"avatar-img", class:"img-responsive img-thumbnail avatar-thumbnail") %> - 
          <%= section.instructor.name %>
          <% else %>
          TBD
        <% end %>
      <%= link_to 'Edit shift', edit_section_path(section), class: 'btn btn-sm btn-warning' %>
    </h3>
    <!-- <h3><%= section.id %></h3> -->
    <table class="instructors-table">
      
      <%= render partial: "lessons/lessons_column_headers" %>

        <% Lesson.where(section_id:section.id).each do |lesson| %>

          <% lesson.students. each do |student| %>
      
      <tbody>
        <tr>         
          <td><%= student.lesson.requester ? student.lesson.requester.name : student.lesson.guest_email %></td>
          <td><%= student.name %></td>
          <td><%= student.age_range %></td>
          <td><%= student.most_recent_level %></td>
          <!-- <td><%= link_to "#{lesson.product.name}", lesson, class: "btn btn-default" %></td> -->
          <% if lesson.requester %>
          <td class="lessons-table-cells lesson-student"><%= lesson.requester.email %></td>
          <% else %>
          <td class="lessons-table-cells lesson-student"><%= lesson.guest_email %></td>
          <% end %>            <!-- <td><%= lesson.location.name %></td> -->
          <td><%= student.lesson.phone_number %></td>
          <td><%= lesson.state %></td>
          <td><%= number_to_currency(lesson.visible_lesson_cost) %></td>
          <td></td>
          <td></td>
          <td><%= link_to 'Edit', edit_lesson_path(lesson), class: "btn btn-sm btn-warning" %></td>
          <td><%= link_to 'Review', lesson, class: "btn btn-sm btn-default" %></td>
          <td><%= link_to 'Cancel', lesson, method: :delete, data: { confirm: 'Are you sure?' },class: "btn btn-sm btn-danger" %></td>
        </tr>
      </tbody>

        <%end%>
        
        <%end%>
      
    </table>

    <% end %>

<% end %>

<div class="buffer"></div>

</div>

</div>
